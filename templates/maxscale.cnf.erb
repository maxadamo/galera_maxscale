<%
server_list = ''
@galera_hosts.each do | key, value |
  server_list = server_list + key + ","
end
server_list = server_list.chomp(",")
-%>
[maxscale]
threads=4

[Splitter Service]
type=service
router=readwritesplit
servers=<%= server_list %>
user=maxscale
passwd=<%= @maxscale_password %>

[Splitter Listener]
type=listener
service=Splitter Service
protocol=MySQLClient
port=3306
#address=<%= @vip_ip %>
socket=/tmp/ClusterMaster

<% @galera_hosts.each do | key, value | -%>
[<%= key %>]
type=server
address=<%= value['ipv4'] %>
port=3306
protocol=MySQLBackend
<% end %>

[Galera Monitor]
type=monitor
module=galeramon
servers=<%= server_list %>
user=maxscale
passwd=<%= @maxscale_password %>

[CLI]
type=service
router=cli

[CLI Listener]
type=listener
service=CLI
protocol=maxscaled
port=6603
